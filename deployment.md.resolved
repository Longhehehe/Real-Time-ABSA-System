# ğŸ³ HÆ°á»›ng Dáº«n Khá»Ÿi Táº¡o Há»‡ Thá»‘ng vá»›i Docker

TÃ i liá»‡u nÃ y hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch thiáº¿t láº­p vÃ  cháº¡y dá»± Ã¡n Real-Time ABSA System sá»­ dá»¥ng Docker Compose.

## 1. YÃªu Cáº§u Há»‡ Thá»‘ng

*   **Docker Desktop**: ÄÃ£ cÃ i Ä‘áº·t vÃ  Ä‘ang cháº¡y (trÃªn Windows khuyáº¿n nghá»‹ dÃ¹ng WSL 2 backend).
*   **RAM**: Tá»‘i thiá»ƒu 8GB (khuyáº¿n nghá»‹ 16GB do cháº¡y Spark vÃ  PhoBERT model).
*   **Disk**: Trá»‘ng Ã­t nháº¥t 10GB.

## 2. CÃ¡c BÆ°á»›c CÃ i Äáº·t

### BÆ°á»›c 1: Chuáº©n Bá»‹ File `.env`
Táº¡o file `.env` táº¡i thÆ° má»¥c gá»‘c cá»§a dá»± Ã¡n (`c:\Users\Long\Documents\Hoc_Tap\SE363 (1)\`) Ä‘á»ƒ cáº¥u hÃ¬nh user ID cho Airflow, trÃ¡nh lá»—i permission.

Cháº¡y lá»‡nh sau trong terminal (PowerShell) táº¡i thÆ° má»¥c dá»± Ã¡n:
```powershell
echo "AIRFLOW_UID=50000" > .env
```
*(Náº¿u báº¡n cháº¡y trÃªn Linux/Mac, dÃ¹ng `echo "AIRFLOW_UID=$(id -u)" > .env`)*

### BÆ°á»›c 2: Khá»Ÿi Táº¡o Database cho Airflow
Láº§n Ä‘áº§u tiÃªn cháº¡y, báº¡n cáº§n khá»Ÿi táº¡o database vÃ  tÃ i khoáº£n admin cho Airflow.

```bash
docker-compose up airflow-init
```
*   **Äá»£i má»™t chÃºt**: QuÃ¡ trÃ¬nh nÃ y sáº½ pull images vÃ  setup DB.
*   **ThÃ nh cÃ´ng khi**: Báº¡n tháº¥y thÃ´ng bÃ¡o `User "admin" created with role "Admin"` vÃ  container `airflow-init` dá»«ng láº¡i vá»›i code 0.

### BÆ°á»›c 3: Khá»Ÿi Cháº¡y ToÃ n Bá»™ Há»‡ Thá»‘ng
Sau khi init xong, cháº¡y lá»‡nh sau Ä‘á»ƒ dá»±ng toÃ n bá»™ cÃ¡c services:

```bash
docker-compose up -d
```
*   `-d`: Cháº¡y ngáº§m (detached mode).


### BÆ°á»›c 4: Cáº¥u HÃ¬nh Cookie (Quan Trá»ng)
Lazada cÃ³ cÆ¡ cháº¿ cháº·n Bot gáº¯t gao. Äá»ƒ Crawler hoáº¡t Ä‘á»™ng, báº¡n cáº§n láº¥y Cookies tá»« trÃ¬nh duyá»‡t tháº­t:

1.  CÃ i extension **EditThisCookie** trÃªn Chrome/Edge.
2.  ÄÄƒng nháº­p Lazada.vn.
3.  Báº¥m extension -> **Export** -> Chá»n **Netscape HTTP Cookie File**.
4.  LÆ°u ná»™i dung vÃ o file: `cookie/lazada_cookies.txt` (trong thÆ° má»¥c dá»± Ã¡n).

## 3. Kiá»ƒm Tra Tráº¡ng ThÃ¡i

Sau khoáº£ng 2-5 phÃºt Ä‘á»ƒ cÃ¡c services khá»Ÿi Ä‘á»™ng hoÃ n táº¥t, báº¡n cÃ³ thá»ƒ truy cáº­p cÃ¡c dá»‹ch vá»¥ táº¡i:

| Dá»‹ch Vá»¥ | URL / Port | TÃ i khoáº£n (náº¿u cÃ³) |
| :--- | :--- | :--- |
| **Streamlit Dashboard** | [http://localhost:8501](http://localhost:8501) | - |
| **Airflow UI** | [http://localhost:8080](http://localhost:8080) | `airflow` / `airflow` |
| **Spark Master UI** | [http://localhost:8081](http://localhost:8081) | - |
| **Kafka** | `localhost:9092` | - |

### Kiá»ƒm tra báº±ng lá»‡nh:
```bash
docker-compose ps
```
Äáº£m báº£o táº¥t cáº£ cÃ¡c containers Ä‘ang á»Ÿ tráº¡ng thÃ¡i `Up` (hoáº·c `running`).

## 4. Quáº£n LÃ½ Há»‡ Thá»‘ng

### Xem Logs
Äá»ƒ xem logs cá»§a má»™t service cá»¥ thá»ƒ (vÃ­ dá»¥ `kafka-consumer` hoáº·c `streamlit-app`):
```bash
docker-compose logs -f kafka-consumer
docker-compose logs -f streamlit-app
```

### Dá»«ng Há»‡ Thá»‘ng
Äá»ƒ dá»«ng cÃ¡c containers nhÆ°ng giá»¯ láº¡i dá»¯ liá»‡u (trong volumes):
```bash
docker-compose stop
```

Äá»ƒ dá»«ng vÃ  xÃ³a toÃ n bá»™ containers & networks (nhÆ°ng giá»¯ volumes):
```bash
docker-compose down
```

Äá»ƒ xÃ³a sáº¡ch toÃ n bá»™ (bao gá»“m cáº£ volumes database - **Cáº©n tháº­n máº¥t dá»¯ liá»‡u**):
```bash
docker-compose down --volumes --remove-orphans
```

## 5. Troubleshooting (Sá»­a Lá»—i ThÆ°á»ng Gáº·p)

*   **Service cá»© restart liÃªn tá»¥c (Exited)**: ThÆ°á»ng do thiáº¿u RAM. HÃ£y tÄƒng RAM cho Docker trong Settings -> Resources.
*   **Lá»—i permission volume**: Äáº£m báº£o báº¡n Ä‘Ã£ set `AIRFLOW_UID` trong file `.env`.
*   **Spark Worker khÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c Master**: Kiá»ƒm tra logs `docker-compose logs spark-worker`.
*   **KhÃ´ng vÃ o Ä‘Æ°á»£c Streamlit**: Äá»£i thÃªm chÃºt, model PhoBERT khÃ¡ náº·ng nÃªn service app khá»Ÿi Ä‘á»™ng lÃ¢u hÆ¡n bÃ¬nh thÆ°á»ng.

---
**LÆ°u Ã½:**
Há»‡ thá»‘ng sá»­ dá»¥ng **PhoBERT** cho viá»‡c training vÃ  prediction, model nÃ y sáº½ Ä‘Æ°á»£c download tá»± Ä‘á»™ng trong láº§n cháº¡y Ä‘áº§u tiÃªn (hoáº·c load tá»« thÆ° má»¥c `models/`), vui lÃ²ng Ä‘áº£m báº£o káº¿t ná»‘i internet á»•n Ä‘á»‹nh.
